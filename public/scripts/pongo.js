Pongo.UI={$body:$(document.body),$win:$(window),$container:$(".wrapper"),$counter:$(".counter"),$list:$(".list"),$page:$("#page-panel"),$overlay:$("#overlay"),$form_group:$(".form-group"),$form_text:$("#text"),$alert_box:$(".alert-msg"),$modal_box:$(".modal-box"),$close_modal:$(".close-modal"),$left_toggle:$(".left-toggle"),$right_toggle:$(".right-toggle"),$right_body:$(".right-body"),$toolbar:$(".toolbar"),$multipanel:$(".multi-panel"),$popup:$(".popup"),$btn_clicked:null,$api_url:null,$modal_url:null,btn_text:null,lang:null,timeout:1e3,multipanel_w:286,loading_tpl:'<i class="fa fa-refresh fa fa-spin"></i> ',counter_tpl:'<span class="label label-primary counter"><%= n %></span>',list_item_tpl:'<li class="dl-item" data-id="<%= file_id %>"><div class="dl-handle"><a href="<%= thumb_url %>" class="<%= thumb_class %>"><%= thumb %></a><span><%= file_name %></span><div><span class="ext"><%= ext %></span><span class="size"><%= size %></span></div></div><a href="<%= edit_url %>" class="<%= edit_class %>" data-default="<%= data_default %>" data-tag="<%= data_tag %>"><i class="fa fa-chevron-left"></i></a><a href="<%= delete_url %>" class="remove confirm"><i class="fa fa-times"></i></a></li>',console:function(a){console.log(a)},debug:function(a){this.$page.html(a)},url:function(a){return Pongo.base+"/"+a},activePopup:function(){this.$list.magnificPopup({delegate:"a.popup",type:"image",closeOnContentClick:!0})},addSpin:function(){this.btn_text=this.$btn_clicked.html(),-1==this.btn_text.indexOf("<i")?this.$btn_clicked.prepend(this.loading_tpl):this.$btn_clicked.find("i").removeClass().addClass("fa fa-refresh fa fa-spin")},checkAllClone:function(){$("#clone_all").change(function(){$(".cloned_element").prop("checked",this.checked)})},cleanStatusBar:function(a){setTimeout(function(){$(".status-bar").remove()},1e3*a)},counterUpDown:function(a){if(0==this.$counter.length&&"up"==a){var b=_.template(this.counter_tpl),c=b({n:0});this.$right_toggle.append(c),this.$counter=$(".counter")}var d=this.$counter.html();"up"==a?d++:d--,this.$counter.html(d),0>=d&&this.$counter.remove()},changeMultiPanel:function(){var a=this,b=a.$toolbar.find("li");b.each(function(c){var d=$(this),e=d.find("a");e.on("click",function(e){e.preventDefault(),a.$right_body.animate({scrollTop:0},0),b.removeClass("active"),d.addClass("active"),a.$multipanel.animate({left:-(c*a.multipanel_w)},200)})})},checkSpin:function(){return this.$btn_clicked.find("i").hasClass("fa fa-spin")},checkTinyMce:function(){if(void 0!==Pongo.Element){var a=Pongo.Element.editor;this.$form_text.text(a.getContent()),a.isNotDirty=!0}},listItemAdd:function(a){var b=_.template(this.list_item_tpl),c=b(a);this.$list.prepend(c),$("li .confirm").unbind("click")},listItemRemove:function(a){this.$list.find("li[data-id="+a+"]").remove(),this.counterUpDown("down"),this.$close_modal.trigger("click")},loadingBtn:function(){var a=this;this.submitBtn(),$("form .btn").on("click",function(b){if(b.preventDefault(),a.$alert_box.remove(),a.$btn_clicked||(a.$btn_clicked=$(this)),!a.checkSpin()){a.addSpin();var c=!a.$btn_clicked.hasClass("api"),d=!a.$btn_clicked.hasClass("confirm"),e=!a.$btn_clicked.hasClass("button");c&&d&&e&&setTimeout(function(){a.$btn_clicked.parents("form").submit()},a.timeout)}})},loadingConfirm:function(){var a=this;$(".list, form").on("click",".confirm",function(b){if(b.preventDefault(),a.$alert_box.remove(),a.$btn_clicked||(a.$btn_clicked=$(this)),!a.checkSpin()){var c=$(this).attr("href");a.addSpin(),a.$modal_box.find(".api").attr("href",c),a.$modal_box.css({"z-index":2001}).addClass("open"),a.$body.addClass("open-modal")}})},loadingIcoBtn:function(){var a=this;$(".btn.loading").on("click",function(){a.$btn_clicked=$(this),a.checkSpin()||a.addSpin()})},confirmForm:function(){var a=this;a.$modal_box.each(function(){var a=$(this).outerHeight()+10;$(this).css({top:-a})}),a.closeConfirm(),$("form .confirm").on("click",function(b){b.preventDefault();var c=$(this);a.$modal_box=$(c.attr("href")),a.$modal_box.css({"z-index":2001}).addClass("open"),a.$body.addClass("open-modal")})},closeConfirm:function(){var a=this;$(".close-modal").on("click",function(b){b.preventDefault(),a.$modal_box.css({"z-index":0}).removeClass("open"),a.$body.removeClass("open-modal"),a.resetBtn()})},createAlertMessage:function(a){var b=this;b.$alert_box.remove();var c=$("<div/>").attr("class","alert-msg").addClass(a.status).html(a.msg);"expired"==a.type?b.redirectTo("login"):(b.$alert_box=c,Modernizr.touch?(b.$alert_box.addClass("fixfixed"),b.$body.animate({scrollTop:0},0).prepend(c)):b.$body.prepend(c))},highlightLayout:function(){var a=this;if($("#layout-preview").length>0){var b=$("#layout-preview");if($("#layout").length>0){var c=$("#layout");c.change(function(){$.post(a.url("api/page/layout/change"),{header:$("#header").val(),layout:c.val(),footer:$("#footer").val()},function(a){a&&$("#template-wrapper").empty().html(a)})})}if($("#zone").length>0){var d=$("#zone"),e=d.val();b.find("[data-zone="+e+"]").addClass("active"),d.change(function(){e=d.val(),b.find(".active").removeClass("active"),b.find("[data-zone="+e+"]").addClass("active")})}}},mobileBrowser:function(){return jQuery.browser.mobile?!0:!1},pageId:function(){var a=$("input[name=page_id]");return a.length>0?a.val():0},paginateList:function(a){$.LoadNext({container:".paginate ol",next:".pagination",next_link:"li:last-child a",item:a,btn_class:"btn btn-primary btn-sm btn-block loading"})},redirectTo:function(a){window.location=this.url(a)},resetBtn:function(){this.btn_text&&this.$btn_clicked&&(this.$btn_clicked.html(this.btn_text),this.$btn_clicked=null)},saveForm:function(){var a=this;$(".api").on("click",function(b){b.preventDefault();var c=$(this),d=c.parents("form");a.$api_url=c.attr("href"),a.checkTinyMce(),$.ajax({url:a.$api_url,type:"POST",data:d.serialize(),dataType:"json",context:a,success:a.validateForm}).done(function(){setTimeout(function(){a.resetBtn()},a.timeout)})})},setWysiwygMinHeight:function(a){var b=this,c=b.viewPortSize("h");return b.$win.resize(function(){return c=b.viewPortSize("h"),c/a}),c/a},submitBtn:function(){var a=this;$("form .btn[type=submit]").on("click",function(b){b.preventDefault(),a.$alert_box.remove(),$(this).parents("form").submit()})},toggleApi:function(){$(".api-toggle").on("click",function(a){a.preventDefault(),$(this).parents(".dl-handle").find(".api").toggle()})},toggleCheckbox:function(){var a=this;$(".linked-pages").on("click",".page_rel",function(){var b=$(this),c=b.parents("form").attr("action"),d=b.val(),e=this.checked?"add":"remove";b.hide().parent("label").prepend(a.loading_tpl),$.post(c,{page_id:a.pageId(),rel_id:d,action:e},function(c){c.status&&setTimeout(function(){b.prev().remove(),b.show()},a.timeout)},"json")})},toggleIsValid:function(){var a=this;$(".valid").on("click",".is_valid",function(){var b=$(this),c=b.parents("form").attr("action"),d=b.val(),e=this.checked?1:0;b.hide().parent("label").prepend(a.loading_tpl),$.post(c,{item_id:d,action:e},function(c){c.status&&setTimeout(function(){b.prev().remove(),b.show()},a.timeout)},"json")})},toggleSearch:function(){$("#search-toggle").on("click",function(a){a.preventDefault(),$('input[type="search"]').toggle().focus()})},validateForm:function(a){this.$form_group.removeClass("has-error"),this.$form_group.find(".err").remove(),a.errors&&Pongo.Page.pageError(a.errors),a.counter&&this.counterUpDown(a.counter),a.infos&&Pongo.Page.pageInform(a.infos),a.page&&Pongo.Page.pageUpdate(a.page),a.element&&Pongo.Page.elementUpdate(a.element),a.role&&Pongo.Role.roleUpdate(a.role),a.user&&Pongo.User.userUpdate(a.user),a.item&&this.listItemAdd(a.item),a.remove&&this.listItemRemove(a.remove),this.createAlertMessage(a)},viewPortSize:function(a){var b=this,c=b.$win.height(),d=b.$win.width(),e=[];return e.w=d,e.h=c,e[a]}},$(function(){Pongo.UI.loadingBtn(),Pongo.UI.loadingConfirm(),Pongo.UI.loadingIcoBtn(),Pongo.UI.saveForm(),Pongo.UI.confirmForm(),Pongo.UI.highlightLayout(),Pongo.UI.mobileBrowser()});